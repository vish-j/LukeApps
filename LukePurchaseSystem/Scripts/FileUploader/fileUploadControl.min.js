"use strict";function _classCallCheck(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var _createClass=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),FileControl;$.fn.InitFileUploader=function(){var n=arguments.length<=0||arguments[0]===undefined?!0:arguments[0];return new FileControl(this,n),this};FileControl=function(){function n(t,i){_classCallCheck(this,n);this.mainControl=t;this.uploadUrl=t.data("upload-url");this.downloadUrl=t.data("download-url");this.dataType=t.data("type");this.filesDisplay=t.find(".filesDisplay");this.keysControl=t.find(".fileKeys");this.filesNames=t.find(".fileNames");this.filesControl=t.find(".fileUploadInput");this.enableDelete=i;this.initFileUpload();this.initiateFileDisplay()}return _createClass(n,[{key:"initiateFileDisplay",value:function(){var r=this,u=function(){return r},t=this.keysControl.val(),i,n;t&&(i=t.split(","),n=this.filesNames.val(),n&&$.each(n.split(","),function(n,t){if(t!==""){var r=i[n];u().addFile(r,t)}}))}},{key:"initFileUpload",value:function(){var n=this,t=function(){return n};this.filesControl.fileupload({url:this.uploadUrl,dataType:"json",sequentialUploads:!0,autoUpload:!0,done:function(n,i){console.log(i);$.each(i.result.Files,function(n,i){t().addFile(i.FileCode,i.FileName)})},progressall:function(n,t){var i=parseInt(t.loaded/t.total*100,10),r=$(this).closest(".form-group").find(".progress .progress-bar");r.css("width",i+"%");r.text(i+"%")},fail:function(){alert("Fail!")}}).prop("disabled",!$.support.fileInput).parent().addClass($.support.fileInput?undefined:"disabled")}},{key:"removeFile",value:function(n,t){$("#"+n).find(".remove-file").off("click");$("#"+n).remove();this.keysControl.val(this.removeValue(this.keysControl.val(),n).replace(/(^,)|(,$)/g,""));this.filesNames.val(this.removeValue(this.filesNames.val(),t).replace(/(^,)|(,$)/g,""));this.dataType==="single"&&this.mainControl.find(".fileUploadInput").removeAttr("disabled")}},{key:"addFile",value:function(n,t){var i=this,r=function(){return i};this.appendDisplay(n,t);$("#"+n).find(".remove-file").bind("click",function(){r().removeFile(n,t)});this.dataType==="single"?(this.mainControl.find(".fileUploadInput").attr("disabled","disabled"),this.keysControl.val(n.replace(/(^,)|(,$)/g,"")),this.filesNames.val(t.replace(/(^,)|(,$)/g,""))):(this.keysControl.val(this.addValue(this.keysControl.val(),n).replace(/(^,)|(,$)/g,"")),this.filesNames.val(this.addValue(this.filesNames.val(),t).replace(/(^,)|(,$)/g,"")))}},{key:"appendDisplay",value:function(n,t){var i='<div class="row"><div class="col-md-9"><span class="glyphicon glyphicon-file"><\/span><a href="'+this.downloadUrl+"?key="+n+'">'+t+'<\/a><\/div><div class="col-md-3">';this.enableDelete&&(i=i+'<a class="remove-file"><span class="glyphicon glyphicon-remove"><\/span><\/a>');i=i+"<\/div><\/div>";$("<div id="+n+' class="list-group-item" />').html(i).appendTo(this.filesDisplay)}},{key:"addValue",value:function(n,t,i){var r,u;for(i=i||",",r=n.split(i),u=0;u<r.length;u++)if(r[u]===t)return n;return r.push(t),r.join(i)}},{key:"removeValue",value:function(n,t,i){var r,u;for(i=i||",",r=n.split(i),u=0;u<r.length;u++)if(r[u]===t)return r.splice(u,1),r.join(i);return n}}]),n}();